<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>安全なパスワードハッシュ</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="faq.using.html">PHP の使いかた</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="faq.html.html">PHP と HTML</a></div>
 <div class="up"><a href="faq.html">FAQ</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="faq.passwords" class="chapter">
  <h1>安全なパスワードハッシュ</h1>

  
  
  <p class="para">
   この節では、なぜハッシュ関数を使ってパスワードを守るのかについての理由と、
   ハッシュ処理を効率的に行う方法について説明します。
  </p>
  
  <div class="qandaset"><ol class="qandaset_questions"><li><a href="#faq.passwords.hashing">
     
      なぜ、アプリケーションのユーザーが登録したパスワードをハッシュしなければならないのですか?
     
    </a></li><li><a href="#faq.passwords.fasthash">
     
      よく使われるハッシュ関数である md5 や
      sha1 は、なぜパスワードのハッシュに適していないのですか?
     
    </a></li><li><a href="#faq.passwords.bestpractice">
     
      よく使われるハッシュ関数では不適切だというのなら、
      パスワードをどうやってハッシュすればいいのですか?
     
    </a></li><li><a href="#faq.passwords.salt">
     
      ソルトとは?
     
    </a></li><li><a href="#faq.password.storing-salts">
     
      How do I store my salts?
     
    </a></li></ol></div>
   <dl class="qandaentry" id="faq.passwords.hashing">
    <dt><strong>
     
      なぜ、アプリケーションのユーザーが登録したパスワードをハッシュしなければならないのですか?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      パスワードのハッシュは、最も基本的なセキュリティ要件のひとつです。
      ユーザーからパスワードを受け取るアプリケーションを設計するときには必ず考慮しなければなりません。
      ハッシュしなければ、パスワードを格納したデータベースが攻撃を受けたときにパスワードを盗まれてしまいます。
      それは即時にアプリケーションが乗っ取られることにつながるし、
      もしそのユーザーが他のサービスでも同じアカウント・同じパスワードを使っていればさらに被害が大きくなります。
     </p>
     <p class="para">
      ユーザーのパスワードにハッシュアルゴリズムを適用してからデータベースに格納しておくと、
      攻撃者が元のパスワードを知ることが難しくなります。
      とはいえ、パスワードのハッシュ結果との比較は可能です。
     </p>
     <p class="para">
      しかし、ここで注意すべき点は、パスワードのハッシュ処理はあくまでもデータベースへの不正アクセスからの保護にすぎず、
      アプリケーション自体に不正なコードを注入される攻撃からは守れないということです。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.fasthash">
    <dt><strong>
     
      よく使われるハッシュ関数である <span class="function"><a href="function.md5.html" class="function">md5()</a></span> や
      <span class="function"><a href="function.sha1.html" class="function">sha1()</a></span> は、なぜパスワードのハッシュに適していないのですか?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      MD5 や SHA1 そして SHA256 といったハッシュアルゴリズムは、
      高速かつ効率的なハッシュ処理のために設計されたものです。
      最近のテクノロジーやハードウェア性能をもってすれば、
      これらのアルゴリズムの出力をブルートフォースで(力ずくで)調べて元の入力を得るのはたやすいことです。
     </p>
     <p class="para">
      最近のコンピュータではハッシュアルゴリズムを高速に「逆算」できるので、
      セキュリティ技術者の多くはこれらの関数をパスワードのハッシュに使わないよう強く推奨しています。
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.bestpractice">
    <dt><strong>
     
      よく使われるハッシュ関数では不適切だというのなら、
      パスワードをどうやってハッシュすればいいのですか?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      パスワードをハッシュするときに検討すべき重要な二点は、
      その計算量とソルトです。
      ハッシュアルゴリズムの計算コストが増えれば増えるほど、
      ブルートフォースによる出力の解析に時間を要するようになります。
     </p>
     <p class="para">
      PHP 5.5 provides
      <a href="book.password.html" class="link">a native password hashing API</a> that
      safely handles both <a href="function.password-hash.html" class="link">hashing</a>
      and <a href="function.password-verify.html" class="link">verifying passwords</a>
      in a secure manner. There is also
      <a href="https://github.com/ircmaxell/password_compat" class="link external">&raquo;&nbsp;a pure PHP compatibility library</a>
      available for PHP 5.3.7 and later.
     </p>
     <p class="para">
      Another option is the <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> function, which
      supports several hashing algorithms in PHP 5.3 and later. When using
      this function, you are guaranteed that the algorithm you select is
      available, as PHP contains native implementations of each supported
      algorithm, in case one or more are not supported by your system.
     </p>
     <p class="para">
      The suggested algorithm to use when hashing passwords is Blowfish, which
      is also the default used by the password hashing API, as it is
      significantly more computationally expensive than MD5 or SHA1, while
      still being scalable.
     </p>
     <p class="para">
      Note that if you are using <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> to verify a
      password, you will need to take care to prevent timing attacks by using
      a constant time string comparison. Neither PHP&#039;s
      <a href="language.operators.comparison.html" class="link">== and === operators</a>
      nor <span class="function"><a href="function.strcmp.html" class="function">strcmp()</a></span> perform constant time string
      comparisons. As <span class="function"><a href="function.password-verify.html" class="function">password_verify()</a></span> will do this for
      you, you are strongly encouraged to use the
      <a href="book.password.html" class="link">native password hashing API</a>
      whenever possible.
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.passwords.salt">
    <dt><strong>
     
      ソルトとは?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      暗号理論におけるソルトとは、ハッシュ処理の際に追加するデータのことです。
      事前に計算済みのハッシュとその元入力の対応表 (レインボーテーブル)
      で出力を解析される可能性を減らすために利用します。
     </p>
     <p class="para">
      端的に言うと、ソルトとはちょっとした追加データです。
      これをつけるだけで、ハッシュをクラックするのが劇的に難しくなります。
      事前に計算済みのハッシュとその元入力を大量にまとめた表が、オンラインで多数公開されています。
      ソルトを使えば、そのハッシュ値がこれらの表に含まれている可能性を大きく減らすことができます。
     </p>
     <p class="para">
      <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> will create a random salt if one
      isn&#039;t provided, and this is generally the easiest and most secure
      approach.
     </p>
    </dd>
   </dl>
   <dl class="qandaentry" id="faq.password.storing-salts">
    <dt><strong>
     
      How do I store my salts?
     
    </strong></dt>
    <dd class="answer">
     <p class="para">
      When using <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> or
      <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span>, the return value includes the salt as part
      of the generated hash. This value should be stored verbatim in your
      database, as it includes information about the hash function that was
      used and can then be given directly to
      <span class="function"><a href="function.password-verify.html" class="function">password_verify()</a></span> or <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> when
      verifying passwords.
     </p>
     <p class="para">
      The following diagram shows the format of a return value from
      <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> or <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span>. As you
      can see, they are self-contained, with all the information on the
      algorithm and salt required for future password verification.
     </p>
     <p class="para">
      <div class="mediaobject">
       
       <div class="imageobject">
        <img src="images/2a34c7f2e658f6ae74f3869f2aa5886f-crypt-text-rendered.svg" alt="
        The components of the value returned by password_hash and crypt: in
        order, the chosen algorithm, the algorithm's options, the salt used,
        and the hashed password.
       " width="690" height="192" />
       </div>
      </div>
     </p>
    </dd>
   </dl>
  
  
 </div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="faq.using.html">PHP の使いかた</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="faq.html.html">PHP と HTML</a></div>
 <div class="up"><a href="faq.html">FAQ</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
