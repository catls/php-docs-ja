<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>OCI8 高速アプリケーション通知 (FAN) サポート</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oci8.connection.html">OCI8 接続のハンドリングおよびプーリング</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="oci8.dtrace.html">OCI8 および DTrace 動的トレーシング</a></div>
 <div class="up"><a href="book.oci8.html">OCI8</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="oci8.fan" class="chapter">
 <h1>OCI8 高速アプリケーション通知 (FAN) サポート</h1>

 <div class="section">
  <p class="para">
   FAN サポートは、高速接続フェイルオーバーという
   Oracle Database 高可用性機能を提供します。
   これにより、データベースマシンまたはデータベース・インスタンスが使用不能になると、
   PHP OCI8 スクリプトに通知されるようになります。
   FAN を使用しないと、数分間かもしれませんが、
   TCP タイムアウトが発生してエラーが返されるまで
   OCI8 がハングアップすることがありえます。
   OCI8 で FAN を有効にすると、
   Web ユーザーが機能停止に気づかないように
   アプリケーションがエラーを検出し、
   使用可能なデータベース・インスタンスに再接続できるようになります。
  </p>
  <p class="para">
   FAN サポートは、PHP とリンクする Oracle クライアント・ライブラリ、
   および Oracle Database の両方のバージョンが 10gR2 以降の場合に使用可能です。
  </p>
  <p class="para">
   データベースインスタンスを生き残らせるための接続がただちに作成されるので、
   FAN は、Oracle のクラスタリング技術 (RAC) のユーザーに役立ちます。
   ブローカーがある場合の Oracle Data Guard のユーザーは、
   スタンバイ用のデータベースがオンラインになる際に
   FAN イベントが生成されることに気づくでしょう。
   スタンドアローンのデータベースは、データベース再始動の際に FAN イベントを送信します。
  </p>
  <p class="para">
   
   For active connections,
   when a machine or database instance becomes unavailable,
   a connection failure error will be returned 
   by the OCI8 extension function currently being called. 
   On a subsequent PHP script re-connect,
   a connection to a surviving database instance will be established.
   The OCI8 extension also transparently cleans up any idle connections
   affected by a database machine or instance failure
   so PHP connect calls will establish a fresh connection
   without the script being aware of any service disruption.
  </p>
  <p class="para">
   <a href="oci8.configuration.html#ini.oci8.events" class="link">oci8.events</a> が
   <em>On</em> の場合、
   
   it is suggested to
   set <a href="oci8.configuration.html#ini.oci8.ping-interval" class="link">oci8.ping_interval</a>
   to -1 to disable pinging,
   since enabling FAN events provide pro-active connection management of idle connections
   made invalid by a service disruption.
  </p>
  <p class="para">
   PHP OCI8 で FAN サポートを有効にするには、
   Oracle 10gR2 以降のライブラリとともに PHP OCI8 をビルドし、
   それらのステップに従います。
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      データベースサービスが FAN イベントをポストできるようにするには、
      特権を持つデータベース管理者として SQL*Plus のようなプログラムを使用します。
      たとえば下記のように使用します。
     </span>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
    SQL&gt; execute dbms_service.modify_service(
                   SERVICE_NAME        =&gt; &#039;sales&#039;,
                   AQ_HA_NOTIFICATIONS =&gt; TRUE);
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <span class="simpara">
      php.ini を編集して以下のように追加します。
     </span>
     <p class="para">
      <div class="informalexample">
       <div class="example-contents screen">
<div class="cdata"><pre>
    oci8.events = On
</pre></div>
       </div>
      </div>
     </p>
    </li>
    <li class="listitem">
     <span class="simpara">
      
      If the application does not already handle OCI8 error conditions,
      modify it to detect failures and take appropriate action.
      これは、再接続や再実行のステートメントを含むかもしれません。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      アプリケーションを実行し、Oracle Database 10gR2 以降に接続します。
     </span>
    </li>
   </ul>
  </p>
 </div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="oci8.connection.html">OCI8 接続のハンドリングおよびプーリング</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="oci8.dtrace.html">OCI8 および DTrace 動的トレーシング</a></div>
 <div class="up"><a href="book.oci8.html">OCI8</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
